{% extends "Aplicacio/base.html" %}
{% block title %}Aplicacio - {{ movie.name }}{% endblock %}
{% block content %}

<span vocab="http://schema.org/" typeof="Movie">

<h1>
    <span property="name">{{ movie.name }}</span>
    {% if user == movie.user %}
        (<a href="{% url 'Aplicacio:movie_edit' movie.id %}">edit</a>)
        (<a href="{% url 'Aplicacio:delete_movie' movie.id %}">delete</a>)
    {% endif %}


</h1>

<h2>MOVIE DETAILS:</h2>
<p>
    DECK: <span property="description"> {{ movie.deck }} </span><br/>
    DURATION: <span property="duration"> {{ movie.duration }} </span><br/>
    REVENUE: {{ movie.revenue }} </br>
    MORE DETAILS: <a href= "{{ movie.detail_url }}" property="url"> link </a>
</p>

<h2>Characters</h2>
<ul>
    {% for character in movie.characters.all %}
            <li property="character"><a href="{% url 'Aplicacio:character_detail' character.id %}">{{ character.name }}</li></a>
    {% empty %}<li>Sorry, no characters for this movie yet.</li>
    {% endfor %}
</ul>

<h2>Locations</h2>
<ul>
    {% for location in movie.locations.all %}
            <li property="contentLocation"><a href="{% url 'Aplicacio:location_detail' location.id %}">{{ location.name }}</li></a>
    {% empty %}<li>Sorry, no locations for this movie yet.</li>
    {% endfor %}
</ul>


<h2>Reviews</h2>
{% if movie.moviereview_set.all|length > 0 %}
<span rel="aggregateRating">
    <p typeof="AggregateRating">
        Average rating <span property="ratingValue">{{ movie.averageRating|stringformat:".1f" }}</span>
        {% with movie.moviereview_set.all|length as reviewCount %}
        from <span property="reviewCount">{{ reviewCount }}</span> review{{ reviewCount|pluralize }}
        {% endwith %}
    </p>
</span>
<ul rel="review">
    {% for review in movie.moviereview_set.all %}
        <li typeof="Review">
            <p rel="reviewRating" typeof="Rating">
                <span property="worstRating" content="{{ RATING_CHOICES.0.0 }}"></span>
                <span property="ratingValue">{{ review.rating }}</span> star{{ review.rating|pluralize }}
                {% with RATING_CHOICES|last as best %}
                <span property="bestRating" content="{{ best.0 }}"></span>
                {% endwith %}
            </p>
            <p property="description">{% if review.comment %}{{ review.comment }}{% endif %}</p>
            <p>Created by <span property="author">{{ review.user }}</span> on
                <span property="datePublished" content="{{ review.date|date:'Y-m-d' }}">{{ review.date }}</span></p>
        </li>
    {% endfor %}
</ul>
{% endif %}

</span>

<h3>Add Review</h3>
<form action="{% url 'Aplicacio:review_create' movie.id %}" method="post">
    {% csrf_token %}
    Message: <textarea name="comment" id="comment" rows="4"></textarea>
    <p>Rating:</p>
    <p>{% for rate in RATING_CHOICES %}
    <input type="radio" name="rating" id="rating{{ forloop.counter }}" value="{{ rate.0 }}" />
    <label for="choice{{ forloop.counter }}">{{ rate.1 }} star{{ rate.0|pluralize }}</label>
    <br/>{% endfor %}
    </p>
    <input type="submit" value="Review" />
</form>

{% endblock %}
{% block footer %}
<div>
  Created by {{ movie.user }} on {{ movie.date }}
</div>
{% endblock %}
